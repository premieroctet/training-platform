import { MdCheckCircle } from "react-icons/md";

<Slides>

<ChapterHeading
  title="Architecture et donn√©es"
  imgSrc={require("../assets/backgrounds/architecture.jpg").default.src}
/>

---

## **Composants containeurs et de pr√©sentation**

---

<SlideHeader slideTitle="Composants containeurs et de pr√©sentation" />

#### **S√©parer les composants en deux cat√©gories:**

- Composants **containeurs** / **screens** / **pages**
- **Data-fetching**
  - Li√©s aux donn√©es et aux actions possibles
  - Composants de **pr√©sentation**
- **Rendering**
  - Affichage et style, ils re√ßoivent des donn√©es et des fonctions en props

---

<SlideHeader slideTitle="Composant containeur" />

#### **Caract√©ristiques d'un composant containeur:**

- D√©finit comment on **r√©cup√®re les donn√©es**
- Pas/peu de **markup JSX**. Pas de styles.
- Fournit **les donn√©es** aux composants de pr√©sentation

---

<SlideHeader slideTitle="Exemple de containeur" />

```jsx
const CommentListContainer = () => {
  const [comments, setComments] = React.useState([]);

  React.useEffect(() => {
    fetch("/comments")
      .then((resp) => resp.json())
      .then((comments) => {
        setComments(comment);
      });
  }, []);

  return <CommentList comments={this.state.comments} />;
};
```

---

<SlideHeader slideTitle="Composant de pr√©sentation" />

#### **Caract√©ristiques d'un composant de pr√©sentation:**

- D√©finit **l'aspect esth√©tique**
- **Peu de d√©pendances** avec l'application
- Ne renseigne pas sur **le moyen de r√©cup√©ration** des donn√©es
- Re√ßoit les donn√©es uniquement **par les props**
- Composant souvent **stateless**

---

<SlideHeader slideTitle="Exemple d'un composant de pr√©sentation" />

```jsx
const CommentList = (props) => {
  return (
    <ul>
      {props.comments.map(({ body, author }) => (
        <li>
          {body}‚Äî{author}
        </li>
      ))}
    </ul>
  );
};
```

---

<SlideHeader slideTitle="Composants containeurs et de pr√©sentation" />

#### **B√©n√©fices de ce motif de conception:**

<List fontSize="1em" textAlign="left" m="0.6em 0" padding="12px 0">
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    S√©paration des couches (donn√©es/rendu)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    R√©utilisation des composants de pr√©sentation
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Evite la duplication des composants
  </ListItem>
</List>

---

<SlideHeader slideTitle="Containeur/Pr√©sentation: r√©sum√©" />

| Container                                        | Pr√©sentation                               |
| ------------------------------------------------ | ------------------------------------------ |
| Comment les choses **marchent**                  | Comment les choses **s'affichent**         |
| **Connait** l'architecture de l'app              | **Ne connait** pas l'architecture de l'app |
| S'occupe de la **r√©cup√©ration des donn√©es**      | **Affiche** les donn√©es                    |
| R√©utilisable (avec render props, ou composition) | R√©utilisable                               |

---

<SlideHeader slideTitle="Containeur/Pr√©sentation: exercice" />

#### **Exercices** - Moteur de recherche Giphy üòé

- Cr√©er une interface pour afficher des gifs selon un terme recherch√©
  - Utiliser l'API de Giphy - https://api.giphy.com/v1/gifs/search?api_key=
    **dc6zaTOxFJmzC**&q=cats
  - Cr√©er une barre de recherche et une liste affichant les gifs retourn√©s
- R√©cup√©rer les donn√©es dans **un composant containeur**
  - Afficher les donn√©es dans **des composants de pr√©sentation**

---

## **Redux**

### Uni-directional data flow

---

<SlideHeader slideTitle="Complexit√© d'une application" />

#### **Complexit√© d'une application**

- **Couplage** : une vue d√©pend d'un ou plusieurs mod√®les
- **Mise √† jour laborieuse**: n√©cessite l'ajout/suppression de listener
- **Effets de bord**, donn√©es erron√©es
- **Stockage des donn√©es** difficile

---

<SlideHeader slideTitle="Exemple : Backbone" />
<Image src={require("./assets/backbone-example.png").default.src} flex="0" />

---

<SlideHeader slideTitle="Redux" />

#### **Redux** √† la rescousse ‚úåÔ∏è

- Une architecture pour g√©rer les flux de donn√©es
- Impose un flux de donn√©e **unidirectionel**
- Permet de **d√©samorcer la complexit√©** d'une application
- Rend le code plus **clair, lisible et scalable**

---

<SlideHeader slideTitle="Le dispatcher" />

#### **Le dispatcher,** chef d'orchestre

- **Un seul** dispatcher par application
- Noeud **central** de l'application
- Responsable de **l'envoi et la r√©ception d'actions**
- Ces actions proviennent le plus souvent **d'interactions utilisateurs**

---

<SlideHeader slideTitle="Les stores" />

#### **Les stores**

- Contiennent **l'√©tat** (les donn√©es) de votre application
- Une action **modifie** un ou plusieurs store via le dispatcher
- Les stores **notifient** les listeners du **changement de leurs √©tats**
- Un store est un **objet JavaScript**

---

<SlideHeader slideTitle="Les actions" />

#### **Les actions**

- Les actions d√©finissent **l'API de votre application**
- Elles traduisent une volont√© d'interaction (r√©cup√©ration de donn√©es, click ‚Ä¶)
- Ce sont des objets JavaScript comportant **un attribut type** et des donn√©es
  facultatives :

```js
{
  type: 'DELETE_ITEM',
  itemId: 1234,
}

{
  type: 'ADD_ITEM',
  itemId: { name: 'Item 1' }
}

```

---

<SlideHeader slideTitle="Les vues" />

#### **Les vues**

- Les donn√©es des stores **sont affich√©es** dans les vues
- Une vue peut-√™tre un **composant React** mais peut aussi provenir d'un autre
  framework
- Une vue **√©coute un store**: √† chaque changement dans un store la vue est
  **mise √† jour** avec les nouvelles donn√©es
- Le flux de donn√©es est toujours dans **le m√™me sens** :

- Les vues envoient les **actions au dispatcher**
- Les **dispatcher** envoie les actions √† tous les **stores**
- Les stores envoient les donn√©es aux **vues**

---

<SlideHeader slideTitle="Une impl√©mentation de Flux" />

#### **Redux: une impl√©mentation de Flux**

- Le dispatcher **disparait** pour √™tre remplac√© par des **reducers**
- Les reducers sont **des fonctions** prenant en entr√©e une action avec des
  donn√©es, et en sortie un nouvel √©tat
- Il y a un **seul store**: tout l'√©tat de votre application est au m√™me endroit
  (single source of truth)

---

<SlideHeader slideTitle="Exemple Redux" />

```jsx
function counter(state = 0, action) {
  switch (action.type) {
    case "INCREMENT":
      return state + 1;
    case "DECREMENT":
      return state - 1;
    default:
      return state;
  }
}
const store = Redux.createStore(counter);
const valueEl = document.getElementById("value");

function render() {
  valueEl.innerHTML = store.getState().toString();
}

render();
store.subscribe(render);

document.getElementById("increment").addEventListener("click", function () {
  store.dispatch({ type: "INCREMENT" });
});
document.getElementById("decrement").addEventListener("click", function () {
  store.dispatch({ type: "DECREMENT" });
});
document
  .getElementById("incrementIfOdd")
  .addEventListener("click", function () {
    if (store.getState() % 2 !== 0) {
      store.dispatch({ type: "INCREMENT" });
    }
  });
```

---

<SlideHeader slideTitle="Redux" />

#### **D√©tails d'impl√©mentation**

- Composants de pr√©sentation: **affiche les donn√©es**
- Composants containeurs: **li√©s au store et aux actions**
- S√©parer les diff√©rentes parties dans des fichiers (actions.js, reducers.js,
  store.js)

##### Exemple d'impl√©mentation:

https://github.com/alinz/example-react-native-redux/tree/master/Counters

---

<SlideHeader slideTitle="Redux" />

#### Recommandations

- Redux est une proposition d'architecture et n'est pas obligatoire pour
  r√©aliser une application
- Cependant cela permet de d√©crire l'√©tat de l'application juste avec des objets
  et tableaux
- D√©crire les changements sous forme d'objet
- D√©crire la logique avec des fonctions pures (d√©terministe)

---

<SlideHeader slideTitle="Redux" />

#### Les avantages

<List fontSize="1em" textAlign="left" m="0.6em 0" padding="12px 0">
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Sauvegarder l'√©tat complet et relancer l'application de cette sauvegarde plus
    tard
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Serializer les actions utilisateurs et les lier √† des rapports de bug pour rejouer
    le parcours
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Cr√©er une application collaborative juste en partageant les actions effectu√©es
    sur le r√©seau
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Facilit√© d'inspection et de debug (nombreux outils d'aide au d√©veloppement)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Facilit√© pour changer de librairie d'interface gr√¢ce au d√©couplage
  </ListItem>
</List>

---

<SlideHeader slideTitle="React native debugger" />

#### N√©cessite un middleware Redux dans l'application

<Image src={require("./assets/react-native-debugger.png").default.src} />

https://github.com/jhen0409/react-native-debugger

---

<SlideHeader slideTitle="Reactotron" />

#### Dev tools en ligne de commande

<Image src={require("./assets/reactotron.png").default.src} />

https://github.com/infinitered/reactotron

---

<SlideHeader slideTitle="Alternatives √† Redux" />

#### Il existe des alternatives

- [Rematch üëå](https://github.com/rematch/rematch) (framework redux => moins de
  boilerplate)
- [ReactQuery üëå](https://react-query.tanstack.com/overview)
- MobX
- [GraphQL + Apollo Client](https://github.com/infinitered/reactotron)

---

<SlideHeader slideTitle="React Query" />

```jsx
import { QueryClient, QueryClientProvider, useQuery } from "react-query";

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  const { isLoading, error, data } = useQuery("repoData", () =>
    fetch("https://api.github.com/repos/tannerlinsley/react-query").then(
      (res) => res.json()
    )
  );

  if (isLoading) return "Loading...";

  if (error) return "An error has occurred: " + error.message;

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>üëÄ {data.subscribers_count}</strong>{" "}
      <strong>‚ú® {data.stargazers_count}</strong>{" "}
      <strong>üç¥ {data.forks_count}</strong>
    </div>
  );
}
```

---

<SlideHeader slideTitle="Exercice : Redux" />

#### Exercices - Mettre en pratique Redux üìêü§ì

- Cr√©er un **store**
- Cr√©er un **reducer** g√©rant **des gifs favoris**
- Utiliser ces actions dans les composants
- http://redux.js.org/

</Slides>
