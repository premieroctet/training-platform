import { MdCheckCircle } from "react-icons/md";

<Slides>

<ChapterHeading
  title="Navigation"
  imgSrc={require("../assets/backgrounds/ship-wheel.jpg").default.src}
/>

---

<SlideHeader slideTitle="Navigation" />

#### L'un des composants container les plus important.

- [react-navigation](https://reactnavigation.org/)
- [react-native-navigation](https://github.com/wix/react-native-navigation)

---

<SlideHeader slideTitle="Navigation : react-navigation" />
<HStack>

- Navigation full JS
- Se rapproche au maximum du comportement de chaque plateforme
- Hautement personnalisable

<Image src={require("./assets/react-navigation.png").default.src} width="35%" />
</HStack>

---

<SlideHeader slideTitle="Navigation : react-navigation" />

```jsx
import * as React from "react";
import { View, Text, Button } from "react-native";
import { NavigationContainer } from "@react-navigation/native";
import { createNativeStackNavigator } from "@react-navigation/native-stack";

function HomeScreen() {
  return (
    <View style={{ flex: 1, alignItems: "center", justifyContent: "center" }}>
      <Text>Home Screen</Text>
    </View>
  );
}

function DetailsScreen() {
  return (
    <View style={{ flex: 1, alignItems: "center", justifyContent: "center" }}>
      <Text>Details Screen</Text>
    </View>
  );
}
```

---

<SlideHeader slideTitle="Navigation : react-navigation" />

```jsx
import * as React from "react";
import { View, Text, Button } from "react-native";
import { NavigationContainer } from "@react-navigation/native";
import { createNativeStackNavigator } from "@react-navigation/native-stack";

// ... components

const Stack = createNativeStackNavigator();

function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator initialRouteName="Home">
        <Stack.Screen name="Home" component={HomeScreen} />
        <Stack.Screen name="Details" component={DetailsScreen} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}
export default App;
```

---

<SlideHeader slideTitle="Navigation : react-navigation" />

```jsx
function HomeScreen() {
  return (
    <View style={{ flex: 1, alignItems: "center", justifyContent: "center" }}>
      <Text>Home Screen</Text>
      <Button
        title="Go to Details"
        onPress={() => navigation.navigate("Details")}
      />
    </View>
  );
}

function DetailsScreen() {
  return (
    <View style={{ flex: 1, alignItems: "center", justifyContent: "center" }}>
      <Text>Details Screen</Text>
    </View>
  );
}
// ... App
```

---

<SlideHeader slideTitle="Navigation : react-native-navigation" />
<HStack>

- Stack de navigation native
- Performance et rendu du système
- Difficile à personnaliser par rapport react-navigation

<Image src={require("./assets/simulator-navigationExperimental.png").default.src} width="35%" />
</HStack>

---

<ChapterHeading
  title="Gestion des données"
  imgSrc={require("../assets/backgrounds/data.jpg").default.src}
/>

---

<SlideHeader slideTitle="Fetch" />

- Standard pour faire des requêtes en JS
- React Native implémente la couche réseau en reproduisant l'API XMLHttpRequest
- Requête native : ([okhttp](https://github.com/square/okhttp) pour Android &
  [NSURLSession](https://developer.apple.com/library/mac/documentation/Foundation/Reference/NSURLSession_class/)
  pour iOS)
- API utilisant les promesses

```jsx
fetch("http://localhost/api/users.json")
  .then(function (response) {
    console.log(response.headers.get("Content-Type"));
    console.log(response.headers.get("Date"));
    console.log(response.status);
    console.log(response.statusText);

    return response.json();
  })
  .then(function (json) {
    console.log("parsed json", json);
  })
  .catch(function (ex) {
    console.log("parsing failed", ex);
  });
```

---

<SlideHeader slideTitle="Fetch: remarques" />

- Fonctionne uniquement par défaut en HTTPS sur IOS ⚠️
  - Il faut mettre à jour le Info.plist
  - http://blog.bigbinary.com/2016/07/27/open-non-https-sites-in-webview-in-react-native.html

---

<SlideHeader slideTitle="AsyncStorage" />

- Base de données clé-valeur
- Dictionnaire serializé sur iOS et SQLite sur Android (rocksDB dans une
  prochaine version)
- Remplace le local storage et utilise une API asynchrone : getItem, setItem,
  removeItem, mergeItem, mutiGet, multiSet...

```js
async _onValueChange(selectedValue) {
  this.setState({selectedValue});
  try {
    await AsyncStorage.setItem(STORAGE_KEY, selectedValue);
    this._appendMessage('Saved selection to disk: ' + selectedValue);
  } catch (error) {
    this._appendMessage('AsyncStorage error: ' + error.message);
  }
},

async _removeStorage() {
  try {
    await AsyncStorage.removeItem(STORAGE_KEY);
    this._appendMessage('Selection removed from disk.');
  } catch (error) {
    this._appendMessage('AsyncStorage error: ' + error.message);
  }
},
```

---

<SlideHeader slideTitle="react-native-storage" />

- https://github.com/sunnylqm/react-native-storage
- Wrapper autour d'AsyncStorage, peut aussi être utilisé en web pour
  LocalStorage
- Contrôle de la taille, auto expiration...

---

<SlideHeader slideTitle="react-native-storage" />

```js
import { AsyncStorage } from "react-native";

const storage = new Storage({
  // maximum capacity, default 1000
  size: 1000,

  // Use AsyncStorage for RN, or window.localStorage for web.
  // If not set, data would be lost after reload.
  storageBackend: AsyncStorage,

  // expire time, default 1 day(1000 * 3600 * 24 milliseconds).
  // can be null, which means never expire.
  defaultExpires: 1000 * 3600 * 24,

  // cache data in the memory. default is true.
  enableCache: true,

  // if data was not found in storage or expired,
  // the corresponding sync method will be invoked and return
  // the latest data.
  sync: {
    // we'll talk about the details later.
  },
});
```

---

<SlideHeader slideTitle="react-native-storage" />

- Synchronisation avec données distantes et requête par lot

```js
storage.sync = {
  // The name of the sync method must be the same of the data's key
  // And the passed params will be an all-in-one object.
  // You can use promise here.
  // Or plain callback function with resolve/reject, like:
  user(params) {
    let { id, resolve, reject } = params;

    fetch("user/", {
      method: "GET",
      body: "id=" + id,
    })
      .then((response) => {
        return response.json();
      })
      .then((json) => {
        if (json && json.user) {
          storage.save({
            key: "user",
            id,
            rawData: json.user,
          });
          // Call resolve() when succeed
          resolve && resolve(json.user);
        } else {
          // Call reject() when failed
          reject && reject(new Error("data parse error"));
        }
      })
      .catch((err) => {
        reject && reject(err);
      });
  },
};
```

---

<SlideHeader slideTitle="SQLite" />

- Pas d'implémentation officielle, disponible via un module :
  [react-native-sqlite-storage](https://github.com/andpor/react-native-sqlite-storage)
- Basé sur l'implémentation du plugin Cordova
- Support des transactions SQL
- API via callbacks ou promesses

---

<SlideHeader slideTitle="SQLite : exemple" />

```js
//...
SQLite.openDatabase({ name: "test5.db", createFromLocation: "~/db/andrew.db" })
  .then((DB) => {
    db = DB;
    this.state.progress.push("Database OPEN");
    this.setState(this.state);

    DB.executeSql(
      "SELECT * FROM Employees a, Departments b WHERE a.department = b.department_id"
    )
      .then(([DB, results]) => {
        this.state.progress.push("Query completed");
        this.setState(this.state);
        const len = results.rows.length;
        for (let i = 0; i < len; i++) {
          let row = results.rows.item(i);
          this.state.progress.push(
            `Empl Name: ${row.name}, Dept Name: ${row.deptName}`
          );
        }
        this.setState(this.state);
      })
      .catch((error) => {
        console.log(error);
      });
  })
  .catch((error) => {
    console.log(error);
  });
//...
```

---

<SlideHeader slideTitle="Firebase" />

- Infrastructure cloud pour votre application
- Base de données temps réel
- Authentification
- Notification push
- Publicité
- Statistiques
- Stockage
- Configuration distante

---

<SlideHeader slideTitle="Crédits" />

- https://flic.kr/p/pudG8L
- https://unsplash.com/search/wheel?photo=Esq0ovRY-Zs
- https://unsplash.com/collections/309717?photo=NuE8Nu3otjo

---

</Slides>
