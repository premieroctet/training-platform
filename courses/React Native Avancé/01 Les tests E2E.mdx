import ChapterHeading from "@/components/mdx/ChapterHeading";
import { MdCheckCircle } from "react-icons/md";

<Slides title="Les tests End 2 End" course="Formation React">

<ChapterHeading title="Tests E2E ğŸ¤–" />

---

#### Les test E2E (end-to-end) <Icon size="lg" as={MdCheckCircle} color="green.300" />

- Permet de tester une application dans sa **globalitÃ©**
- ExÃ©cute les tests dans **un simulateur ou device** ğŸ“±
- Tests qui reflÃ¨tent le plus **la rÃ©alitÃ©**

---

#### Detox ğŸ¥¤

- Librairie de tests **E2E pour React Native**
- DÃ©veloppÃ© par Wix
- https://github.com/wix/Detox

---

#### Detox

<List>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Cross platform (Android / iOS)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    ExÃ©cutable dans un CI (Travis, Bitrise)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    GÃ¨re automatiquement les transitions :
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="transparent" />
    RequÃªtes rÃ©seaux, animations, timers, RN Bridgeâ€¦
  </ListItem>
</List>

---

#### Installer les outils Detox

`brew tap wix/brew`

`brew install applesimutils`

`yarn global add detox-cli`

---

#### Ajouter Detox Ã  votre projet RN

`yarn add --dev detox`

---

#### Configurer Detox âš™ï¸

##### Ajoutez Ã  votre **package.json**

<Box fontSize="0.7em" >

```json
{
  "detox": {
    "test-runner": "jest",
    "configurations": {
      "ios.sim.debug": {
        "binaryPath": "ios/build/Build/Products/Debug-iphonesimulator/app.app",
        "build": "xcodebuild -workspace ios/app.xcworkspace -configuration Debug -sdk iphonesimulator -scheme app -derivedDataPath ios/build",
        "type": "ios.simulator",
        "name": "iPhone X"
      }
    }
  }
}
```

</Box>

---

#### Configurer Detox âš™ï¸

##### Bootstrappez les tests (crÃ©ation d'un exemple de test) :

```
detox init -r jest
```

---

#### Build et lancement des tests ğŸˆ

```
detox build
detox test
```

---

#### Boite Ã  outils de Detox ğŸ§°

<List fontSize="1em" textAlign="left" m="0.6em 0" padding="12px 0">
  <ListItem>ğŸ‘‰ Les actions</ListItem>
  <ListItem>ğŸ¯ Les sÃ©lecteurs (Matchers)</ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Les validateurs (Expectations)
  </ListItem>
</List>

---

#### Boite Ã  outils de Detox ğŸ§°

##### ğŸ‘‰ <b>Les actions</b>

- Permet d'interagir avec les Ã©lements
  - tap()
  - scroll()
  - swipe()
  - ...
- [APIRef.ActionsOnElement.md](https://github.com/wix/Detox/blob/master/docs/APIRef.ActionsOnElement.md)

---

#### Boite Ã  outils de Detox ğŸ§°

##### ğŸ¯ <b>Les sÃ©lecteurs</b> (Matchers)

- Permet de sÃ©lectionner des Ã©lements
  - by.id() (depuis un attribut testID)
  - by.text()
  - by.label()
  - ...
- [APIRef.Matchers.md](https://github.com/wix/Detox/blob/master/docs/APIRef.Matchers.md)

---

#### Boite Ã  outils de Detox ğŸ§°

##### âœ… <b>Les validateurs</b> (Expectations)

- Permet de valider l'existence d'un Ã©lement
  - toBeVisible()
  - toHaveText()
  - toNotExist()
  - ...
- [APIRef.Expect.md](https://github.com/wix/Detox/blob/master/docs/APIRef.Expect.md)

---

#### Exemple de test

```js
describe("Login flow", () => {
  it("should login successfully", async () => {
    await device.reloadReactNative();
    await expect(element(by.id("email"))).toBeVisible();

    await element(by.id("email")).typeText("john@example.com");
    await element(by.id("password")).typeText("123456");
    await element(by.text("Login")).tap();

    await expect(element(by.text("Welcome"))).toBeVisible();
    await expect(element(by.id("email"))).toNotExist();
  });
});
```

---

<SlideHeader slideTitle="Mise en pratique : Test avec Detox" />

##### ğŸ“ğŸ¤“ <b>Detox</b> : mise en pratique

- CrÃ©ez une app RN 0.60
- Installez Detox
- CrÃ©ez un Ã©cran d'onboarding avec
  [react-native-onboarding-swiper](https://github.com/jfilter/react-native-onboarding-swiper)
- Testez les diffÃ©rents Ã©crans avec le swipe

</Slides>
