import ChapterHeading from "@/components/mdx/ChapterHeading";
import { MdCheckCircle } from "react-icons/md";

<Slides title="Les tests End 2 End" course="Formation React">

<ChapterHeading title="Tests E2E 🤖" />

---

#### Les test E2E (end-to-end) <Icon size="lg" as={MdCheckCircle} color="green.300" />

- Permet de tester une application dans sa **globalité**
- Exécute les tests dans **un simulateur ou device** 📱
- Tests qui reflètent le plus **la réalité**

---

#### Detox 🥤

- Librairie de tests **E2E pour React Native**
- Développé par Wix
- https://github.com/wix/Detox

---

#### Detox

<List>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Cross platform (Android / iOS)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Exécutable dans un CI (Travis, Bitrise)
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Gère automatiquement les transitions :
  </ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="transparent" />
    Requêtes réseaux, animations, timers, RN Bridge…
  </ListItem>
</List>

---

#### Installer les outils Detox

`brew tap wix/brew`

`brew install applesimutils`

`yarn global add detox-cli`

---

#### Ajouter Detox à votre projet RN

`yarn add --dev detox`

---

#### Configurer Detox ⚙️

##### Ajoutez à votre **package.json**

<Box fontSize="0.7em" >

```json
{
  "detox": {
    "test-runner": "jest",
    "configurations": {
      "ios.sim.debug": {
        "binaryPath": "ios/build/Build/Products/Debug-iphonesimulator/app.app",
        "build": "xcodebuild -workspace ios/app.xcworkspace -configuration Debug -sdk iphonesimulator -scheme app -derivedDataPath ios/build",
        "type": "ios.simulator",
        "name": "iPhone X"
      }
    }
  }
}
```

</Box>

---

#### Configurer Detox ⚙️

##### Bootstrappez les tests (création d'un exemple de test) :

```
detox init -r jest
```

---

#### Build et lancement des tests 🎈

```
detox build
detox test
```

---

#### Boite à outils de Detox 🧰

<List fontSize="1em" textAlign="left" m="0.6em 0" padding="12px 0">
  <ListItem>👉 Les actions</ListItem>
  <ListItem>🎯 Les sélecteurs (Matchers)</ListItem>
  <ListItem>
    <ListIcon as={MdCheckCircle} color="green.300" />
    Les validateurs (Expectations)
  </ListItem>
</List>

---

#### Boite à outils de Detox 🧰

##### 👉 <b>Les actions</b>

- Permet d'interagir avec les élements
  - tap()
  - scroll()
  - swipe()
  - ...
- [APIRef.ActionsOnElement.md](https://github.com/wix/Detox/blob/master/docs/APIRef.ActionsOnElement.md)

---

#### Boite à outils de Detox 🧰

##### 🎯 <b>Les sélecteurs</b> (Matchers)

- Permet de sélectionner des élements
  - by.id() (depuis un attribut testID)
  - by.text()
  - by.label()
  - ...
- [APIRef.Matchers.md](https://github.com/wix/Detox/blob/master/docs/APIRef.Matchers.md)

---

#### Boite à outils de Detox 🧰

##### ✅ <b>Les validateurs</b> (Expectations)

- Permet de valider l'existence d'un élement
  - toBeVisible()
  - toHaveText()
  - toNotExist()
  - ...
- [APIRef.Expect.md](https://github.com/wix/Detox/blob/master/docs/APIRef.Expect.md)

---

#### Exemple de test

```js
describe("Login flow", () => {
  it("should login successfully", async () => {
    await device.reloadReactNative();
    await expect(element(by.id("email"))).toBeVisible();

    await element(by.id("email")).typeText("john@example.com");
    await element(by.id("password")).typeText("123456");
    await element(by.text("Login")).tap();

    await expect(element(by.text("Welcome"))).toBeVisible();
    await expect(element(by.id("email"))).toNotExist();
  });
});
```

---

<SlideHeader slideTitle="Mise en pratique : Test avec Detox" />

##### 📐🤓 <b>Detox</b> : mise en pratique

- Créez une app RN 0.60
- Installez Detox
- Créez un écran d'onboarding avec
  [react-native-onboarding-swiper](https://github.com/jfilter/react-native-onboarding-swiper)
- Testez les différents écrans avec le swipe

</Slides>
