import { Image } from "@chakra-ui/image";
import ChapterHeading from "@/components/mdx/ChapterHeading";
import { MdCheckCircle, MdCancel } from "react-icons/md";

<Slides title="introduction" course="Formation React">

<ChapterHeading title="Cr√©er un module natif üì≤" />

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module ? üì≤

- Permet d'exposer √† RN des fonctionnalit√©s iOS / Android
- Communique via le Bridge React Native
- Doit √™tre cr√©er dans Xcode (iOS) et Android Studio

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec iOS üçè

- Fichier Objective C impl√©mentant **le protocole RCTBridgeModule**
- La classe doit inclure le macro **RCT_EXPORT_MODULE()**
- Les m√©thodes doivent √™tre exposer via **RCT_EXPORT_METHOD()**
- https://facebook.github.io/react-native/docs/native-modules-ios

---

<Image src={require("./assets/native1.png").default.src} />

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec iOS üçè

```objc
// ios/Device.h
#import <React/RCTBridgeModule.h>

@interface Device : NSObject <RCTBridgeModule>
@end
```

```objc
// ios/Device.m
#import "Device.h"

@implementation Device

RCT_EXPORT_MODULE();

@end
```

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec iOS üçè

- Appel de la m√©thode c√¥t√© JS :

```jsx
import React, { useState } from "react";
import { NativeModules, Text } from "react-native";
import { Container } from "../../layout/elements";

const DeviceInfo = () => {
  const [device, setDevice] = useState();

  NativeModules.Device.getDeviceName((err, name) => {
    if (!err) {
      setDevice(name);
    }
  });

  return <Container>{device && <Text> {device} </Text>}</Container>;
};

export default DeviceInfo;
```

---

<SlideHeader slideTitle="Mise en pratique : Native Module" />

##### üìêü§ì <b>Native Module</b> : mise en pratique

- Cr√©er un module natif sur iOS
- Exposez le nom du device
- Affichez le nom du device dans RN

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec Android ü§ñ

- Classe Java √©tendant **la classe ReactContextBaseJavaModule**
- Les m√©thodes doivent avoir l'annotation **@ReactMethod** pour √™tre expos√©s
- https://facebook.github.io/react-native/docs/native-modules-android

---

<Image src={require("./assets/native1.png").default.src} />

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

##### Native Module avec Android : DeviceModule.java

```java
public class DeviceModule extends ReactContextBaseJavaModule {
   public DeviceModule(ReactApplicationContext reactContext) {
       super(reactContext);
   }
   @Override
   public String getName() {
       return "Device";
   }
   @ReactMethod
   public void getDeviceName(Callback cb) {
       try{
           cb.invoke(null, android.os.Build.MODEL);
       }catch (Exception e){
           cb.invoke(e.toString(), null);
       }
   }
}
```

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec Android : DevicePackage.java

```java
public class DevicePackage implements ReactPackage {
  @Override
  public List<ViewManager> createViewManagers(ReactApplicationContext reactContext) {
    return Collections.emptyList();
  }
  @Override
  public List<NativeModule> createNativeModules(
          ReactApplicationContext reactContext) {
    List<NativeModule> modules = new ArrayList<>();
    //We import the module file here
    modules.add(new DeviceModule(reactContext));

    return modules;
  }
  // Backward compatibility
  public List<Class<? extends JavaScriptModule>> createJSModules() {
    return new ArrayList<>();
  }
}
```

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Importer le package dans le MainApplication

```java
@Override
protected List<ReactPackage> getPackages() {
  @SuppressWarnings("UnnecessaryLocalVariable")
  List<ReactPackage> packages = new PackageList(this).getPackages();

  // Here
  packages.add(new DevicePackage());
  return packages;
}
```

---

<SlideHeader slideTitle="Cr√©er un Native Module" />

#### Native Module avec Android

- Appel de la m√©thode c√¥t√© JS :

```jsx
import React, { useState } from "react";
import { NativeModules, Text } from "react-native";
import { Container } from "../../layout/elements";

const DeviceInfo = () => {
  const [device, setDevice] = useState();

  NativeModules.Device.getDeviceName((err, name) => {
    if (!err) {
      setDevice(name);
    }
  });

  return <Container>{device && <Text> {device} </Text>}</Container>;
};

export default DeviceInfo;
```

</Slides>
